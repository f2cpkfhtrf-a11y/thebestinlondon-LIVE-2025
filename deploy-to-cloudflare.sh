#!/bin/bash

# Cloudflare Pages Deployment Automation
# Project: thebestinlondon

echo "🚀 CLOUDFLARE PAGES DEPLOYMENT SCRIPT"
echo "======================================"
echo ""

ACCOUNT_ID="9947c88df88e197e6588e6f5fdb734a6"
PROJECT_NAME="thebestinlondon"
GITHUB_REPO="f2cpkfhtrf-a11y/thebestinlondon-LIVE-2025"

echo "✅ Account ID: $ACCOUNT_ID"
echo "✅ GitHub Repo: $GITHUB_REPO"
echo ""

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo "❌ Error: Not in project directory"
    echo "Please run: cd ~/Desktop/thebestinlondon"
    exit 1
fi

echo "📍 Current directory: $(pwd)"
echo ""

# Open Cloudflare Workers & Pages
echo "🌐 Opening Cloudflare Workers & Pages..."
open "https://dash.cloudflare.com/$ACCOUNT_ID/workers-and-pages"

echo ""
echo "🔍 CHECKING CLOUDFLARE PAGES STATUS..."
echo ""
echo "Please check the Cloudflare dashboard that just opened:"
echo ""
echo "───────────────────────────────────────────────────"
echo "IF YOU SEE A PROJECT CALLED 'thebestinlondon':"
echo "───────────────────────────────────────────────────"
echo "  1. Click on the project"
echo "  2. Check deployment status:"
echo "     • ✅ SUCCESS → Copy the URL (thebestinlondon.pages.dev)"
echo "     • ❌ FAILED → Click to see error logs"
echo "     • 🔄 IN PROGRESS → Wait 2-3 minutes"
echo ""
echo "  3. If you want to trigger a new deployment:"
echo "     • Go to Settings → Builds & deployments"
echo "     • Click 'Retry deployment' on latest build"
echo ""
echo "───────────────────────────────────────────────────"
echo "IF YOU DON'T SEE 'thebestinlondon' PROJECT:"
echo "───────────────────────────────────────────────────"
echo "  You need to create it! Here's how:"
echo ""
echo "  1. Click 'Create application' button"
echo "  2. Click 'Pages' tab"
echo "  3. Click 'Connect to Git'"
echo "  4. Select GitHub repository: $GITHUB_REPO"
echo "  5. Click 'Begin setup'"
echo ""
echo "  6. Configure build settings:"
echo "     • Project name: thebestinlondon"
echo "     • Production branch: main"
echo "     • Framework preset: Next.js"
echo "     • Build command: npm run build"
echo "     • Build output directory: .next"
echo ""
echo "  7. Click 'Save and Deploy'"
echo ""
echo "  Build will take 2-3 minutes!"
echo ""
echo "───────────────────────────────────────────────────"
echo ""

# Ask user what they see
echo "❓ WHAT DO YOU SEE IN CLOUDFLARE?"
echo ""
echo "Type one of these and press Enter:"
echo "  A - Project exists and is SUCCESS ✅"
echo "  B - Project exists and is FAILED ❌"
echo "  C - Project exists and is IN PROGRESS 🔄"
echo "  D - No project found, need to create ⚙️"
echo ""
read -p "Your answer (A/B/C/D): " answer

case $answer in
    A|a)
        echo ""
        echo "🎉 EXCELLENT! Your site is LIVE!"
        echo ""
        echo "📋 NEXT STEPS:"
        echo "  1. Copy your Cloudflare Pages URL (should be: thebestinlondon.pages.dev)"
        echo "  2. Test it in browser"
        echo "  3. If working, update DNS to point thebestinlondon.co.uk to it"
        echo ""
        read -p "Paste your .pages.dev URL here: " pages_url
        echo ""
        echo "🌐 Opening your live site: $pages_url"
        open "$pages_url"
        echo ""
        echo "✅ DEPLOYMENT COMPLETE!"
        ;;
    B|b)
        echo ""
        echo "🔧 DEPLOYMENT FAILED - Let's fix it!"
        echo ""
        echo "📋 STEPS TO FIX:"
        echo "  1. In Cloudflare dashboard, click on the failed deployment"
        echo "  2. Scroll down to see the error logs"
        echo "  3. Copy the error message"
        echo ""
        echo "Then I can help you fix it!"
        echo ""
        echo "Common issues and fixes:"
        echo "  • 'npm install failed' → Usually a package issue"
        echo "  • 'Build failed' → Check build logs for specific error"
        echo "  • 'next.config.js error' → Config syntax issue"
        echo ""
        read -p "Press Enter when you have the error message..."
        echo ""
        echo "Paste the error here, and I'll help fix it!"
        ;;
    C|c)
        echo ""
        echo "⏳ BUILD IN PROGRESS - Almost there!"
        echo ""
        echo "Your site is being built right now. This takes 2-3 minutes."
        echo ""
        echo "📋 WHAT TO DO:"
        echo "  1. Wait 2-3 minutes"
        echo "  2. Refresh the Cloudflare page"
        echo "  3. Check if status changed to SUCCESS ✅"
        echo ""
        echo "☕ Grab a coffee and come back in 3 minutes!"
        echo ""
        read -p "Press Enter when build is complete..."
        echo ""
        echo "Now run this script again and select option A!"
        ;;
    D|d)
        echo ""
        echo "🔧 NO PROJECT FOUND - Let's create it!"
        echo ""
        echo "📋 FOLLOW THESE STEPS IN CLOUDFLARE:"
        echo ""
        echo "1. Click 'Create application' (blue button)"
        echo "2. Click 'Pages' tab"
        echo "3. Click 'Connect to Git'"
        echo ""
        read -p "Done? Press Enter to continue..."
        echo ""
        echo "4. Authorize GitHub access (if prompted)"
        echo "5. Select repository: $GITHUB_REPO"
        echo "6. Click 'Begin setup'"
        echo ""
        read -p "Done? Press Enter to continue..."
        echo ""
        echo "7. Enter these settings:"
        echo "   • Project name: thebestinlondon"
        echo "   • Production branch: main"
        echo "   • Framework preset: Next.js"
        echo "   • Build command: npm run build"
        echo "   • Build output directory: .next"
        echo ""
        echo "8. Scroll down"
        echo "9. Click 'Save and Deploy' (blue button)"
        echo ""
        read -p "Done? Press Enter when deployment starts..."
        echo ""
        echo "🎉 DEPLOYMENT STARTED!"
        echo ""
        echo "⏳ This will take 2-3 minutes."
        echo "You'll see the build progress in Cloudflare."
        echo ""
        echo "When it's done, run this script again and select option A!"
        ;;
    *)
        echo ""
        echo "Invalid option. Please run the script again."
        ;;
esac

echo ""
echo "─────────────────────────────────────────"
echo "📖 DOCUMENTATION"
echo "─────────────────────────────────────────"
echo "• Full guide: CHECK-CLOUDFLARE-NOW.md"
echo "• Project status: COMPLETE-STATUS-OCT-15.md"
echo "• Build details: BUILD-STATUS.md"
echo ""
echo "🚀 Script complete!"
